#!/bin/sh

function check_file() 
{
    if [ -f "$1" ]
    then
        echo "$2" >> config.mk
    fi
}

function try_exec() 
{
    if [ -f "$1" ]
    then
        $1
    fi
}

function check_command()
{
    if ! command -v $1 2>&1 >/dev/null
    then
        echo "error: command $1 not found"
        exit 1
    fi
}

function testonly_command()
{
    if ! command -v $1 2>&1 >/dev/null
    then
        echo "warning: command $1 not found [used in tests]"
        exit 1
    fi
}

echo "# AUTOGENERATED BY CONFIGURE" > config.mk
check_file "/usr/bin/watcom/owsetenv.sh" "WATCOM=/usr/bin/watcom"
try_exec   /usr/bin/watcom/owsetenv.sh
check_file "/usr/local/watcom/owsetenv.sh" "WATCOM=/usr/local/watcom"
try_exec   /usr/local/watcom/owsetenv.sh
check_file "/usr/local/bin/watcom/owsetenv.sh" "WATCOM=/usr/local/bin/watcom"
try_exec   /usr/local/bin/watcom/owsetenv.sh
check_file "/usr/shared/watcom/owsetenv.sh" "WATCOM=/usr/shared/watcom"
try_exec   /usr/shared/watcom/owsetenv.sh
echo "ROOT=`pwd`" >> config.mk
check_command cc
check_command wcl386
check_command wcl
check_command dd
check_command mformat
check_command mcopy
check_command zip
check_command install
testonly_command nasm
testonly_command ndisasm
testonly_command emu2